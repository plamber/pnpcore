<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Multi-Geo | PnP Core SDK </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Multi-Geo | PnP Core SDK ">
    <meta name="generator" content="docfx 2.59.2.0">
    <meta name="description" content="The PnP Core SDK is a modern .NET SDK designed to work for Microsoft 365. It provides a unified object model for working with SharePoint Online and Teams which is agnostic to the underlying API's being called.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/plamber/pnpcore/blob/dev/docs/using-the-sdk/admin-m365-multigeo.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="multi-geo">Multi-Geo</h1>

<p>The Core SDK Admin library provides Microsoft 365 Admin APIs for understanding the multi-geo setup of a tenant.</p>
<h2 id="creating-context">Creating Context</h2>
<p>In this article, you'll see a lot of <code>context</code> use: in this case this is a <code>PnPContext</code> which was obtained via the <code>PnPContextFactory</code> as explained in the <a href="readme.html">overview article</a> and show below:</p>
<pre><code class="lang-csharp">using (var context = await pnpContextFactory.CreateAsync(&quot;SiteToWorkWith&quot;))
{
    // See next chapter on how to use the PnPContext for doing Microsoft 365 admin operations
}
</code></pre>
<h2 id="pnpcoreadmin-dependency">PnP.Core.Admin dependency</h2>
<p>The functionality shown in this article depends on the <a href="https://www.nuget.org/packages/PnP.Core.Admin">PnP.Core.Admin nuget package</a>. Once the PnP.Core.Admin nuget package has been installed you can get to the Microsoft 365 admin features via using the <code>GetMicrosoft365Admin</code> extension method:</p>
<pre><code class="lang-csharp">using (var context = await pnpContextFactory.CreateAsync(&quot;SiteToWorkWith&quot;))
{
    // Use the GetMicrosoft365Admin extension method on any PnPContext 
    // to tap into the Microsoft 365 admin features
    var isMultiGeo = await context.GetMicrosoft365Admin().IsMultiGeoTenantAsync();
}
</code></pre>
<h2 id="discover-if-a-tenant-is-a-multi-geo-tenant">Discover if a tenant is a multi-geo tenant</h2>
<p>Most tenants are single geo, meaning their data lives in one region. If the tenant you're working with is multi-geo it's data is spread over two or more geo locations, for example the tenant can have SharePoint and Teams data hosted in Europe and in the US. Each geo location will have it's own Tenant Admin Center site, it's own personal and portal site hosts and more. If you want to find out if the tenant you're working with supports multiple geo's you can use the <code>IsMultiGeoTenant</code> methods:</p>
<pre><code class="lang-csharp">if (await context.GetMicrosoft365Admin().IsMultiGeoTenantAsync())
{
    // Enumerate geo locations and perform admin task per geo
}
else
{
    // Perform admin task for the tenant
}
</code></pre>
<h2 id="listing-the-geo-locations-of-a-tenant">Listing the geo locations of a tenant</h2>
<p>If you want to understand the multi-geo setup of a tenant then using the <code>GetMultiGeoLocations</code> methods will give you the needed details. These methods will return the key information per geo location in the tenant. The returned data includes:</p>
<ul>
<li>Data location code: a <a href="https://docs.microsoft.com/en-us/microsoft-365/enterprise/plan-for-multi-geo?view=o365-worldwide">code identifying a geo location</a></li>
<li>SharePoint Tenant Admin Center url</li>
<li>SharePoint Portal url</li>
<li>SharePoint my site host url</li>
</ul>
<p>Below sample shows how to use the <code>GetMultiGeoLocations</code> methods:</p>
<pre><code class="lang-csharp">foreach(var location in await context.GetMicrosoft365Admin().GetMultiGeoLocationsAsync())
{
    // Do admin work per geo location
}
</code></pre>
<h2 id="creating-new-site-collections-in-the-right-geo-location">Creating new site collections in the right geo location</h2>
<p>How to use PnP Core SDK to create site collections is described in the <a href="admin-sharepoint-sites.html#creating-site-collections">Site Collections</a> page. When working in a multi-geo tenant it's important to control where a site collection will be created and therefore some additional steps have to be taken in account. These steps depend per category of sites and used permissions:</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Delegated permissions</th>
<th>Application permissions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Modern, no group</td>
<td>Ensure the <code>context</code> you use is for a site in the target geo location + specify URL valid for the target geo location</td>
<td>Ensure the <code>context</code> you use is for a site in the target geo location + specify URL valid for the target geo location</td>
</tr>
<tr>
<td>Modern, with group</td>
<td>Ensure the <code>context</code> you use is for a site in the target geo location + set the <code>PreferredDataLocation</code> value in the <code>TeamSiteOptions</code></td>
<td>Set the <code>PreferredDataLocation</code> value in the <code>TeamSiteOptions</code></td>
</tr>
<tr>
<td>Classic site</td>
<td>Ensure the <code>context</code> you use is for a site in the target geo location + specify URL valid for the target geo location</td>
<td>Ensure the <code>context</code> you use is for a site in the target geo location + specify URL valid for the target geo location</td>
</tr>
</tbody>
</table>
<p>So for modern sites without group and classic sites the story is simple: ensure the context and new site url you specify are valid for the target geo location. For group connected sites the story is different as the group's location determines where the associated SharePoint site will be created. To correctly do that you need to specify the <code>PreferredDataLocation</code>:</p>
<pre><code class="lang-csharp">teamSiteToCreate = new TeamSiteOptions(alias, &quot;PnP Core SDK Test&quot;)
{
    Description = &quot;This is a test site collection&quot;,
    Language = Language.English,
    IsPublic = true,
    PreferredDataLocation = GeoLocation.NAM
};

// Ensure the used context is for a site in NAM geo location
using (var newSiteContext = await context.GetSiteCollectionManager().CreateSiteCollectionAsync(teamSiteToCreate))
{
    // Do work on the created site collection via the newSiteContext
}
</code></pre>
<p>If you don't specify the <code>PreferredDataLocation</code> during the creation then the preferred data location from the account creating the team site (if any) is taken, if not the site will be created in the default geo location.</p>
</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>PnP Core SDK<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer">
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>  </body>
</html>