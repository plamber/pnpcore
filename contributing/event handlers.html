<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Event handlers | PnP Core SDK </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Event handlers | PnP Core SDK ">
    <meta name="generator" content="docfx 2.59.2.0">
    <meta name="description" content="The PnP Core SDK is a modern .NET SDK designed to work for Microsoft 365. It provides a unified object model for working with SharePoint Online and Teams which is agnostic to the underlying API's being called.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/plamber/pnpcore/blob/dev/docs/contributing/event handlers.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="event-handlers">Event handlers</h1>

<p>When you add/extend the model, you will have an option to use event handlers. This article lists and explains the available event handlers, providing short samples.</p>
<h2 id="event-handler-overview">Event handler overview</h2>
<table>
<thead>
<tr>
<th>Event handler</th>
<th>Delegate</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AddApiCallHandler</code></td>
<td><code>Task&lt;ApiCall&gt; AddApiCall(Dictionary&lt;string, object&gt; additionalInformation);</code></td>
<td>When you want to implement <strong>Add</strong> on a model class you need to use this event handler</td>
</tr>
<tr>
<td><code>GetApiCallOverrideHandler</code></td>
<td><code>Task&lt;ApiCallRequest&gt; GetApiCallOverride(ApiCallRequest input);</code></td>
<td>You can use this handler to override or cancel the <strong>get</strong> API call that was created based upon the model decoration</td>
</tr>
<tr>
<td><code>UpdateApiCallOverrideHandler</code></td>
<td><code>Task&lt;ApiCallRequest&gt; UpdateApiCallOverride(ApiCallRequest input);</code></td>
<td>You can use this handler to override or cancel the <strong>update</strong> API call that was created based upon the model decoration</td>
</tr>
<tr>
<td><code>DeleteApiCallOverrideHandler</code></td>
<td><code>Task&lt;ApiCallRequest&gt; DeleteApiCallOverride(ApiCallRequest input);</code></td>
<td>You can use this handler to override or cancel the <strong>delete</strong> API call that was created based upon the model decoration</td>
</tr>
<tr>
<td><code>MappingHandler</code></td>
<td><code>TResult Func&lt;in T, out TResult&gt;(T arg);</code></td>
<td>Use this handler to customize how the JSON received from the server is mapped to the model. Typically used to handle enumerations and special fields</td>
</tr>
<tr>
<td><code>PostMappingHandler</code></td>
<td><code>void Action&lt;in T&gt;(T obj);</code></td>
<td>This handler is fired after the complete JSON to model mapping was done and allows you to perform extra logic using the JSON snippet received from the server</td>
</tr>
<tr>
<td><code>ValidateUpdateHandler</code></td>
<td><code>void ValidateUpdate(ref FieldUpdateRequest fieldUpdateRequest);</code></td>
<td>If you want to perform checks before you allow a property in the model to be updated, then use this event handler</td>
</tr>
</tbody>
</table>
<h2 id="event-handlers-in-the-model-lifecycle">Event handlers in the model lifecycle</h2>
<p>Event handlers fire in a certain order when triggered by an action on the model. In below example a Team is loaded requiring a get request, as such the <code>GetApiCallOverrideHandler</code> fires. Unless the get request is cancelled in the event handler, the server is queried and JSON results are returned. During mapping of the JSON results to the model the <code>MappingHandler</code> is fired for each property for which there's no default mapping. Finally the full JSON to model mapping is done and the <code>PostMappingHandler</code> fires allowing you to perform extra processing if needed.</p>
<p><img src="../images/eventhandler.png" alt="Event handler firing"></p>
<h3 id="addapicallhandler">AddApiCallHandler</h3>
<p>This handler is required when you want to implement <strong>Add</strong> functionality on a model class. In the handler you use the properties of the model class instance to be added (<code>DisplayName</code> and <code>Description</code>) to construct the JSON payload, which you then wrap into the respective Microsoft Graph or SharePoint REST API call.</p>
<pre><code class="lang-csharp">internal partial class TeamChannel
{
    private const string baseUri = &quot;teams/{Parent.GraphId}/channels&quot;;

    internal TeamChannel()
    {
        // Handler to construct the Add request for this channel
        AddApiCallHandler = async (additionalInformation) =&gt;
        {
            // Define the JSON body of the update request based on the actual changes
            dynamic body = new ExpandoObject();
            body.displayName = DisplayName;
            if (!string.IsNullOrEmpty(Description))
            {
                body.description = Description;
            }

            // Serialize object to json
            var bodyContent = JsonSerializer.Serialize(body, typeof(ExpandoObject), new JsonSerializerOptions { WriteIndented = false });

            return new ApiCall(ParseApiRequest(baseUri), ApiType.Graph, bodyContent);
        };
    }
}
</code></pre>
<h3 id="getapicalloverridehandler">GetApiCallOverrideHandler</h3>
<p>This event handler is meant to be a last resort, it can override/cancel the generated get query. Typically one should not have to do this, but the option is available for special cases like shown in below example where the system prevents getting the Team if the connected SharePoint site collection is not group connected (as it never can have a Team in that case).</p>
<pre><code class="lang-csharp">internal partial class Team
{
    internal Team()
    {
        GetApiCallOverrideHandler = async (ApiCallRequest api) =&gt;
        {
            if (!PnPContext.Site.IsPropertyAvailable(p =&gt; p.GroupId) || PnPContext.Site.GroupId == Guid.Empty)
            {
                api.CancelRequest(&quot;There is no Microsoft 365 group attached to the current site&quot;);
            }

            return api;
        };

    }
}
</code></pre>
<h3 id="updateapicalloverridehandler-and-deleteapicalloverridehandler">UpdateApiCallOverrideHandler and DeleteApiCallOverrideHandler</h3>
<p>Manipulating updates and deletes is a more common scenario, especially preventing updates/deletes from happening. In below example, you see how sending an update or delete request to the server for the General channel of a Team is prevented.</p>
<pre><code class="lang-csharp">internal partial class TeamChannel
{
    internal TeamChannel()
    {
        UpdateApiCallOverrideHandler = async (ApiCallRequest apiCallRequest) =&gt;
        {
            if (DisplayName == &quot;General&quot;)
            {
                apiCallRequest.CancelRequest(&quot;Updating the general channel is not allowed.&quot;);
            }

            return apiCallRequest;
        };

        DeleteApiCallOverrideHandler = async (ApiCallRequest apiCallRequest) =&gt;
        {
            if (DisplayName == &quot;General&quot;)
            {
                apiCallRequest.CancelRequest(&quot;Deleting the general channel is not allowed.&quot;);
            }

            return apiCallRequest;
        };
    }
}
</code></pre>
<h3 id="mappinghandler">MappingHandler</h3>
<p>The MappingHandler is the most commonly used event handler. You'll see a lot of the model and complex type classes implement this handler. The core purpose of this handler is to handle the JSON to model mapping in cases where this is not done automatically. Also note that when you set the <code>UseCustomMapping</code> property of the <code>GraphFieldMapping</code> or <code>SharePointFieldMapping</code> attributes to true, this handler will also be called for those properties. By default the handler will only be called when there's no automatic JSON to model mapping available, for example in the case of enumerations.</p>
<pre><code class="lang-csharp">internal partial class TeamChannel
{
    internal TeamChannel()
    {
        MappingHandler = (FromJson input) =&gt;
        {
            switch (input.TargetType.Name)
            {
                case &quot;TeamChannelMembershipType&quot;: return ToEnum&lt;TeamChannelMembershipType&gt;(input.JsonElement);
            }

            input.Log.LogDebug($&quot;Field {input.FieldName} could not be mapped when converting from JSON&quot;);

            return null;
        };
    }
}
</code></pre>
<h3 id="postmappinghandler">PostMappingHandler</h3>
<p>This handler fires after the received JSON has been fully processed. You get the processed JSON as a string for additional needs.</p>
<pre><code class="lang-csharp">internal Web()
{
    PostMappingHandler = (string json) =&gt;
    {
        // implement post mapping handler, in case you want to do extra data loading/mapping work
    };
}
</code></pre>
<h3 id="validateupdatehandler">ValidateUpdateHandler</h3>
<p>Validating properties being updated is a common use case. Sometimes you want to prevent certain model properties from being updated, or you want to &quot;rewrite&quot; the updated value. In below example updating model properties for the General Team channel is prevented.</p>
<pre><code class="lang-csharp">internal partial class TeamChannel
{
    internal TeamChannel()
    {
        // Validation handler to prevent updating the general channel
        ValidateUpdateHandler = (PropertyUpdateRequest propertyUpdateRequest) =&gt;
        {
            // Prevent setting all values on the general channel
            if (DisplayName == &quot;General&quot;)
            {
                propertyUpdateRequest.CancelUpdate(&quot;Updating the general channel is not allowed.&quot;);
            }
        };
    }
}
</code></pre>
</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>PnP Core SDK<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer">
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>  </body>
</html>