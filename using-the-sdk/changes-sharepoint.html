<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Enumerating changes that happened in SharePoint | PnP Core SDK </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Enumerating changes that happened in SharePoint | PnP Core SDK ">
    <meta name="generator" content="docfx 2.59.2.0">
    <meta name="description" content="The PnP Core SDK is a modern .NET SDK designed to work for Microsoft 365. It provides a unified object model for working with SharePoint Online and Teams which is agnostic to the underlying API's being called.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/plamber/pnpcore/blob/dev/docs/using-the-sdk/changes-sharepoint.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="enumerating-changes-that-happened-in-sharepoint">Enumerating changes that happened in SharePoint</h1>

<p>SharePoint Online does track many of the changes made to sites, lists, list items, folders and more. Using the <code>GetChanges</code> methods you can enumerate these changes and use them in your application: a common scenario is using a web hook on a library that notifies your code a change has happened and then your code uses a <code>GetChanges</code> call to figure out the exact change details.</p>
<p>In the remainder of this article you'll see a lot of <code>context</code> use: in this case this is a <code>PnPContext</code> which was obtained via the <code>PnPContextFactory</code> as explained in the <a href="readme.html">overview article</a> and show below:</p>
<pre><code class="lang-csharp">using (var context = await pnpContextFactory.CreateAsync(&quot;SiteToWorkWith&quot;))
{
    // See next chapter on how to use the PnPContext for working with files
}
</code></pre>
<h2 id="scoping-the-change-query">Scoping the change query</h2>
<p>To get changes you issue a query via one of the <code>GetChanges</code> methods and to configure the change query you have to pass in a <code>ChangeQueryOptions</code> instance. Via the <code>ChangeQueryOptions</code> you specify for which SharePoint objects (e.g. Item, List,...) you need changes and which change types (e.g. Add, Update, ...) you're interested in. The possible SharePoint objects are:</p>
<ul>
<li>Item</li>
<li>List</li>
<li>Web</li>
<li>Site</li>
<li>File</li>
<li>Folder</li>
<li>Alert</li>
<li>User</li>
<li>Group</li>
<li>ContentType</li>
<li>Field</li>
<li>SecurityPolicy</li>
<li>View</li>
</ul>
<p>And the possible change types are:</p>
<ul>
<li>Add</li>
<li>Update</li>
<li>DeleteObject</li>
<li>Rename</li>
<li>Move</li>
<li>Restore</li>
<li>RoleDefinitionAdd</li>
<li>RoleDefinitionDelete</li>
<li>RoleDefinitionUpdate</li>
<li>RoleAssignmentAdd</li>
<li>RoleAssignmentDelete</li>
<li>GroupMembershipAdd</li>
<li>GroupMembershipDelete</li>
<li>SystemUpdate</li>
<li>Navigation</li>
</ul>
<h2 id="performing-a-change-query">Performing a change query</h2>
<p>A change query is performed via one of the <code>GetChanges</code> methods, passing in a configured <code>ChangeQueryOptions</code> instance. The <code>GetChanges</code> methods are available on these SharePoint model classes:</p>
<ul>
<li>ISite</li>
<li>IWeb</li>
<li>IList</li>
<li>IListItem</li>
<li>IFolder</li>
</ul>
<p>The model on which you call <code>GetChanges</code> scopes the result: calling <code>GetChanges</code> on an IList will only return changes for that particular list. Below sample gets all types of changes for all SharePoint objects scoped to a web.</p>
<pre><code class="lang-csharp">// Get all type of changes for all SharePoint objects
var changes = context.Web.GetChanges(new ChangeQueryOptions(true, true));
</code></pre>
<p>Below sample shows how to get all ContentType and Field adds, updates and deletes for a site collection:</p>
<pre><code class="lang-csharp">// Get adds, updates and deletes for contenttypes and fields 
var changes = context.Site.GetChanges(new ChangeQueryOptions()
                    {
                      ContentType = true,  
                      Field = true,
                      Add = true,
                      Update = true,
                      DeleteObject = true
                    }
);
</code></pre>
<p>In this example the last 50 changes, regardless of change type, for items in a list are returned:</p>
<pre><code class="lang-csharp">// Get all type of changes for a SharePoint list limited to the 50 most recent changes
var list = await context.Web.Lists.GetByTitleAsync(&quot;Documents&quot;);
var changes = await context.Site.GetChangesAsync(new ChangeQueryOptions(false, true)
                    {
                      List = true,  
                      FetchLimit = 50
                    }
);
</code></pre>
<p>When getting changes you often want to just get the changes since you previously asked for changes and this can be done by using change tokens. Each change you get contains a change token and when making a next change query you can get all changes starting from a given change token:</p>
<pre><code class="lang-csharp">// Get all type of changes for all SharePoint objects
var changes = context.Web.GetChanges(new ChangeQueryOptions(true, true));

// Store the change token received with the last change
var lastChangetoken = changes.Last().ChangeToken;

// Get all changes that happened after the last change
var changes2 = await context.Web.GetChangesAsync(new ChangeQueryOptions(true, true)
                {
                    ChangeTokenStart = firstChangeToken
                });
</code></pre>
<p>The <code>lastChangeToken</code> in previous example is of type <code>IChangeToken</code>, if you've stored the actual change token (e.g.&quot;1;2;8c8e101c-1b0d-4253-85e7-c30039bf46e2;637577313637500000;563287977&quot;) you can construct an <code>IChangeToken</code> for it as follows:</p>
<pre><code class="lang-csharp">var lastChangetoken = new ChangeTokenOptions(&quot;1;2;8c8e101c-1b0d-4253-85e7-c30039bf46e2;637577313637500000;563287977&quot;);
</code></pre>
<h2 id="processing-the-returned-changes">Processing the returned changes</h2>
<p>The returned collection of changes all inherit of the same base model <code>IChange</code>, but depending on the changed object you get different model. Changes on a web result in a <code>IChangeWeb</code> instance, changes on a list in a <code>IChangeList</code> instance and so on. When iterating over the changes you can check for the type and cast it as shown in below example. When a change is returned not all properties of the returned object are always populated, use the <code>IsPropertyAvailable</code> method to verify a property is populated before using it (in case the property is not always populated).</p>
<pre><code class="lang-csharp">// Get adds, updates and deletes for contenttypes and fields 
var changes = context.Site.GetChanges(new ChangeQueryOptions()
                    {
                      ContentType = true,  
                      Field = true,
                      Add = true,
                      Update = true,
                      DeleteObject = true
                    }
);

foreach (var change in changes)
{
    if (change is IChangeItem changeItem)
    {
        DateTime changeTime = changeItem.Time;
        
        if (changeItem.IsPropertyAvailable&lt;IChangeItem&gt;(p =&gt; p.ListId))
        {
            // do something with the returned list id
        }      

        if (changeItem.ChangeType == ChangeType.Add)
        {
            // do something &quot;add&quot; specific
        }
    } 
    else if (change is IChangeField changeField)
    {
        // process the change
    }
}
</code></pre>
</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>PnP Core SDK<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer">
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>  </body>
</html>